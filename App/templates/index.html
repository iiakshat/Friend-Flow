<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta name="author" content="Akshat Sanghvi" />
    <link rel="stylesheet" href="../static/index.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin> 

    <title>
        Whatsapp Chat Analysis
    </title>

</head>

<body>
    <form action="{{ url_for('upload') }}" method="POST" enctype="multipart/form-data" class="main-form">
    <h2>Friend Flow 📈</h2>
    <div class="uploader" id="uploaderSection">
        <label class="bold-font" for="filePicker">Handpick Your Chat: </label>
        <input class="choose-file" type="file" name="fileInput" id="filePicker" accept=".txt">
    </div>
    
    <p class="bold-font">OR</p>

    <center class="upload" id="dropArea">
        <p class="bold-font">Drag & Drop It Here</p>
        <input type="file" name="file" id="fileInput" accept=".txt" style="display: none;">
    </center>
    
    <div class="remove-file" id="removeFileSection" style="display: none;">
        <button id="removeFileButton" onclick="removeFile()">Remove File ❌</button>
    </div>
    
        <input class="analysis-button" type="submit" value="Upload">
    </form>
    
    <script>
    const dropArea = document.getElementById('dropArea');
    const uploaderSection = document.getElementById('uploaderSection');
    const removeFileSection = document.getElementById('removeFileSection');
    const removeFileButton = document.getElementById('removeFileButton');
    const dropAreaText = document.querySelector('.drop-area p.bold-font');

    ['dragenter', 'dragover', 'dragleave', 'drop'].forEach(eventName => {
        dropArea.addEventListener(eventName, preventDefaults, false);
        document.body.addEventListener(eventName, preventDefaults, false);
    });

    ['dragenter', 'dragover'].forEach(eventName => {
        dropArea.addEventListener(eventName, highlight, false);
    });

    ['dragleave', 'drop'].forEach(eventName => {
        dropArea.addEventListener(eventName, unhighlight, false);
    });

    dropArea.addEventListener('drop', handleDrop, false);

    function preventDefaults(e) {
        e.preventDefault();
        e.stopPropagation();
    }

    function highlight() {
        dropArea.classList.add('highlight');
    }

    function unhighlight() {
        dropArea.classList.remove('highlight');
    }

    function handleDrop(e) {
        const dt = e.dataTransfer;
        const files = dt.files;

        handleFiles(files);
    }

    function handleFiles(files) {
        if (files.length > 0) {
            const uploadedFile = files[0];
            const fileNameDisplay = document.createElement('p');
            fileNameDisplay.innerText = `Uploaded File: ${uploadedFile.name}`;

            dropAreaText.innerHTML = ''; 
            dropAreaText.appendChild(fileNameDisplay);
            uploaderSection.style.display = 'none';
            dropArea.classList.remove('uploader', 'drop-area');

            removeFileSection.style.display = 'block';


            const reader = new FileReader();
            reader.onload = function (event) {
                const fileContent = event.target.result;

                console.log("Uploaded File Content:", fileContent);
            };
            reader.readAsText(uploadedFile);
        }
    }

    function removeFile() {
        dropAreaText.innerHTML = 'Drag & Drop It Here';

        uploaderSection.style.display = 'block';
        dropArea.classList.add('uploader', 'drop-area');

        removeFileSection.style.display = 'none';
    }

    dropArea.addEventListener('click', () => {
        document.getElementById('fileInput').click();
    });

    document.getElementById('fileInput').addEventListener('change', (e) => {
        const files = e.target.files;
        handleFiles(files);
    });
</script>

</body>
</html>
